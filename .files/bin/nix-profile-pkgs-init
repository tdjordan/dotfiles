#!/usr/bin/env zsh

set -o pipefail

declare installed=()

_np_add() {
  if command -v $1 &>/dev/null; then
    installed+=($1)
  else
    echo .. installing $1 : $2
    nix profile add $2
  fi
}

pkgs=(
  tree-sitter       nixpkgs#tree-sitter
  aws               nixpkgs#awscli2
  gimme-aws-creds   nixpkgs#gimme-aws-creds
  saml2aws          nixpkgs#saml2aws
  devenv            nixpkgs#devenv
  nix-search        github:peterldowns/nix-search-cli
  kubectl           nixpkgs#kubectl
  kubectx           nixpkgs#kubectx
  kubecolor         nixpkgs#kubecolor
  kustomize         nixpkgs#kustomize
  k9s               nixpkgs#k9s
  stern             nixpkgs#stern
  tsh               nixpkgs#teleport
  tenv              nixpkgs#tenv
  kind              nixpkgs#kind
  minikube          nixpkgs#minikube
  vcluster          nixpkgs#vcluster
  k3d               nixpkgs#k3d
  crossplane        nixpkgs#crossplane-cli
  cilium            nixpkgs#cilium-cli
  cliam             nixpkgs#cliam
  jf                nixpkgs#jfrog-cli
  jj                nixpkgs#jujutsu
  jjui              nixpkgs#jjui
  # lazyjj            nixpkgs#lazyjj
  just              nixpkgs#just
  task              nixpkgs#go-task
  watch             nixpkgs#unixtools.watch
  # sentry-cli        nixpkgs#sentry-cli
  snyk              nixpkgs#snyk
  tkn               nixpkgs#tektoncd-cli
  typos             nixpkgs#typos
  ripsecrets        nixpkgs#ripsecrets
  ansible           nixpkgs#ansible
  # ansible-lint      nixpkgs#ansible-lint
  helm              nixpkgs#kubernetes-helm
  kubeseal          nixpkgs#kubeseal
  eksctl            nixpkgs#eksctl
  git-who           nixpkgs#git-who
  pstree            nixpkgs#pstree
  cue               nixpkgs#cue
  mmdc              nixpkgs#mermaid-cli
  magick            nixpkgs#imagemagick_light
  gs                nixpkgs#ghostscript_headless
  brush             nixpkgs#brush
  starship          nixpkgs#starship
  hyperfine         nixpkgs#hyperfine
  uv                nixpkgs#uv
  sk                nixpkgs#skim
  jnv               nixpkgs#jnv
  jq                nixpkgs#jq
  jqp               nixpkgs#jqp
  grex              nixpkgs#grex
  bandwhich         nixpkgs#bandwhich
  fzf-make          nixpkgs#fzf-make
  python            nixpkgs#python3Full
  pipx              nixpkgs#pipx
  gita              nixpkgs#gita
                    # python313Packages.pyjwt
  # localstack        nixpkgs#localstack
  # az                nixpkgs#azure-cli
  # wt                nixpkgs#git-worktree-switcher
  git-cliff         nixpkgs#git-cliff
  lazygit           nixpkgs#lazygit
  eza               nixpkgs#eza
  aiac              nixpkgs#aiac
  # tectonic          nixpkgs#tectonic
  alejandra         nixpkgs#alejandra
  stylua            nixpkgs#stylua
  nixfmt            nixpkgs#nixfmt
  lefthook          nixpkgs#lefthook
  popeye            nixpkgs#popeye
  ipinfo            nixpkgs#ipinfo
  nvimpager         nixpkgs#nvimpager
  step              nixpkgs#step-cli
  # vault             nixpkgs#vault
  # julia             nixpkgs#julia
  # bacon             nixpkgs#bacon
  # lstr              nixpkgs#lstr
  # make              nixpkgs#gnumake
  # packer            nixpkgs#packer
  # opa               nixpkgs#open-policy-agent
  # btop              nixpkgs#btop
  # localsend         nixpkgs#localsend
  # argo              nixpkgs#argo-workflows
  # argocd            nixpkgs#argocd
  # otel-cli          nixpkgs#otel-cli
  sesh                nixpkgs#sesh
  gum                 nixpkgs#gum
  xh                  nixpkgs#xh
  curlie              nixpkgs#curlie
  posting             nixpkgs#posting
  )
  # bw                nixpkgs#bitwarden-cli
  # localsend         nixpkgs#localsend

for k v in ${(kv)pkgs} ; do
  _np_add $k $v
done

echo ":: Already Installed :: "
for k in $installed ; do
  echo $k
done | sort | column -x
